# 开发文档

## 📋 项目概述

这是一个功能完整的Google身份验证器Chrome浏览器扩展，实现了基于TOTP（Time-based One-time Password）的双因素认证功能。

## 🎯 核心功能

### 1. TOTP认证
- ✅ 完整的RFC 6238标准实现
- ✅ 支持Base32编码的密钥
- ✅ 使用HMAC-SHA1算法
- ✅ 30秒时间窗口更新

### 2. 账户管理
- ✅ 多账户支持
- ✅ 智能名称解析（issuer(name)格式）
- ✅ 使用频率统计和排序
- ✅ 一键删除功能

### 3. 二维码功能
- ✅ 摄像头实时扫描
- ✅ 页面二维码扫描（支持图片、SVG、Canvas、CSS背景）
- ✅ 图片文件导入
- ✅ 拖拽图片支持
- ✅ Google Authenticator迁移格式支持

### 4. 用户界面
- ✅ 现代化设计
- ✅ 圆形倒计时器
- ✅ 一键复制验证码
- ✅ 智能筛选和搜索
- ✅ 响应式布局

## 📁 文件结构

```
chrome-tools/
├── manifest.json              # 扩展配置文件
├── popup.html                 # 主界面
├── popup.js                   # 主逻辑
├── background.js              # 后台脚本
├── content.js                 # 内容脚本
├── js/                        # JavaScript库
│   ├── authenticator.js       # TOTP算法
│   ├── jsQR.js               # 二维码扫描
│   └── qrcode.min.js         # 二维码生成
├── icons/                     # 扩展图标
├── scripts/                   # 打包脚本
│   ├── package.sh            # Linux/macOS打包脚本
│   ├── package.bat           # Windows打包脚本
│   ├── build-crx.sh          # CRX打包脚本
│   └── build-crx-simple.sh   # 简化CRX打包脚本
└── docs/                      # 文档目录
    ├── INSTALL.md            # 安装指南
    ├── DEVELOPMENT.md        # 开发文档
    ├── IMPORT_EXPORT.md      # 导入导出指南
    └── FAQ.md                # 常见问题
```

## 🛠️ 技术实现

### 架构设计
- **Manifest V3**：使用最新的Chrome扩展标准
- **模块化设计**：清晰的代码结构和职责分离
- **事件驱动**：基于消息传递的组件通信
- **异步处理**：使用Promise和async/await

### 核心技术
- **Web Crypto API**：用于HMAC-SHA1加密
- **Canvas API**：用于二维码图像处理
- **Chrome Storage API**：用于数据持久化
- **Chrome Scripting API**：用于动态脚本注入

### 数据处理
- **protobuf解析**：支持Google Authenticator迁移格式
- **UTF-8解码**：正确处理中文账户名称
- **Base32编码**：标准密钥格式支持
- **JSON存储**：结构化的数据存储

## 🔧 开发环境

### 环境要求
- Chrome 88+ 或基于Chromium的浏览器
- 支持Manifest V3的浏览器版本
- 现代JavaScript开发环境

### 本地开发
1. 克隆项目到本地
2. 在Chrome中加载扩展（开发者模式）
3. 修改代码后点击"重新加载"按钮

### 调试技巧
- 使用Chrome DevTools调试popup和content script
- 在background script中使用console.log
- 使用Chrome扩展管理页面查看错误信息

## 📊 版本历史

### v1.2.2 - 扫描功能完善版本（2024-01-15）
#### 主要改进
- ✅ 完善页面二维码扫描功能，支持多种载体格式
- ✅ 扩展扫描范围，支持SVG、Canvas、CSS背景图片
- ✅ 优化扫描体验，添加进度反馈和智能通知
- ✅ 增强错误处理，完善跨域处理和错误恢复机制

#### 技术实现
- 新增 `analyzeSVGForQR()` 函数，支持SVG元素扫描
- 新增 `analyzeBackgroundImageForQR()` 函数，支持CSS背景图片扫描
- 改进 `scanPageImages()` 函数，支持更多元素类型和进度跟踪
- 优化 `showNotification()` 函数，支持不同类型的通知显示

### v1.2.1 - 用户体验优化版本（2024-01-15）
#### 主要改进
- ✅ 修复验证码刷新滚动位置问题
- ✅ 优化验证码更新机制，减少不必要的DOM重建
- ✅ 智能渲染策略，区分完整渲染和轻量更新

#### 技术实现
- 新增 `updateTokensOnly()` 函数，专门处理验证码更新
- 在 `displayAccounts()` 中添加滚动位置保存和恢复机制
- 优化定期更新逻辑，从完整重新渲染改为轻量更新

### v1.2.0 - 导入导出功能版本（2024-01-15）
#### 主要改进
- ✅ 完整的JSON格式数据导出功能
- ✅ JSON格式数据导入功能
- ✅ 二维码导出功能（生成迁移二维码）
- ✅ 数据验证和完整性检查

## 🔒 安全特性

### 数据安全
- **本地存储**：所有数据仅存储在本地浏览器
- **无网络传输**：不向任何服务器发送数据
- **权限最小化**：仅请求必要的浏览器权限
- **标准算法**：使用经过验证的加密算法

### 隐私保护
- **无数据收集**：不收集任何用户信息
- **无跟踪**：不跟踪用户行为
- **透明性**：开源代码，可审计
- **用户控制**：用户完全控制自己的数据

## 📈 性能优化

### 代码优化
- **懒加载**：按需加载功能模块
- **缓存机制**：减少重复计算
- **事件节流**：优化高频操作
- **内存管理**：及时清理不需要的资源

### 用户体验
- **快速响应**：优化界面响应速度
- **流畅动画**：使用CSS动画提升体验
- **智能更新**：按需更新验证码
- **错误恢复**：优雅的错误处理

## 🧪 测试

### 功能测试
- ✅ 基础TOTP功能
- ✅ 二维码扫描
- ✅ 数据迁移
- ✅ 用户界面交互
- ✅ 错误处理

### 兼容性测试
- ✅ Chrome 88+
- ✅ Edge 88+
- ✅ 不同操作系统
- ✅ 不同屏幕尺寸

### 安全测试
- ✅ 数据存储安全
- ✅ 权限使用检查
- ✅ 输入验证
- ✅ 错误信息泄露

## 🚀 部署和分发

### 打包工具
- **自动化脚本**：支持Linux/macOS/Windows
- **版本管理**：自动版本号生成
- **文档生成**：完整的安装和使用文档
- **验证工具**：安装后功能验证

### 分发方式
- **开发者模式**：适合开发者和高级用户
- **打包安装**：适合普通用户分发
- **文档支持**：详细的安装和使用指南
- **技术支持**：完整的问题排查指南

## 🔮 未来规划

### 功能扩展
- **更多算法**：支持HOTP、TOTP-SHA256等
- **账户分组**：支持账户分类和标签
- **备份恢复**：账户数据备份和恢复
- **多语言**：国际化支持

### 技术改进
- **性能优化**：进一步提升响应速度
- **代码重构**：优化代码结构
- **测试覆盖**：增加自动化测试
- **文档完善**：持续改进文档质量

### 用户体验
- **主题支持**：自定义界面主题
- **快捷键**：键盘快捷键支持
- **通知功能**：验证码到期提醒
- **移动端**：移动浏览器支持

## 📝 开发规范

### 代码风格
- 使用ES6+语法
- 统一的命名规范
- 适当的注释和文档
- 模块化的代码结构

### 提交规范
- 清晰的提交信息
- 功能分支开发
- 代码审查流程
- 测试覆盖要求

### 文档要求
- 完整的API文档
- 用户使用指南
- 开发者文档
- 更新日志维护
